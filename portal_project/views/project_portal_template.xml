<odoo>
    <template id="my_tasks" inherit_id="project.portal_my_tasks">
        <xpath expr="//th[last()]" position="replace">
            <th class="text-left">Status</th>
        </xpath>
        <xpath expr="//th[3]" position="attributes">
            <attribute name="class">text-left</attribute>
        </xpath>
        <xpath expr="//th[last()]" position="before">
            <th class="text-left">Start</th>
            <th class="text-left">Finish</th>
        </xpath>
        <xpath expr="//th[last()]" position="after">
            <th class="text-left">Tags</th>
        </xpath>
        
        <xpath expr="//t[@t-as='task']" position="attributes">
            <attribute name="t-foreach">tasks.sorted(key=lambda x: (x.stage_id.sequence, x.sequence))</attribute>
        </xpath>
        
        <xpath expr="//tbody//tr/td[last()]" position="replace">
            <td class="text-left">
                <t t-if="task.kanban_state=='in_progress'">
                    <t t-set="label_color" t-value="'primary'"/>
                    <t t-set="label_icon" t-value="'far fa-play-circle'"/>
                </t>
                <t t-elif="task.kanban_state=='blocked'">
                    <t t-set="label_color" t-value="'danger'"/>
                    <t t-set="label_icon" t-value="'fa fa-ban'"/>
                </t>
                <t t-elif="task.kanban_state=='normal'">
                    <t t-set="label_color" t-value="'info'"/>
                    <t t-set="label_icon" t-value="'far fa-circle'"/>
                </t>
                <t t-elif="task.kanban_state=='warning'">
                    <t t-set="label_color" t-value="'warning'"/>
                    <t t-set="label_icon" t-value="'fa fa-exclamation-circle'"/>
                </t>
                <t t-else="">
                    <t t-set="label_color" t-value="'success'"/>
                    <t t-set="label_icon" t-value="'far fa-check-circle'"/>
                </t>
                <span t-attf-class="badge badge-pill badge-#{label_color}">
                    <i t-attf-class="#{label_icon}"/>
                    <span t-esc="task.kanban_state_label"/>
                </span>
            </td>
        </xpath>
        <xpath expr="//tbody//tr/td[2]" position="attributes">
            <attribute name="class">text-left</attribute>
        </xpath>
        <xpath expr="//span[@t-esc='task.stage_id.name']" position="attributes">
            <attribute name="class" />
        </xpath>        
        <xpath expr="//tbody//tr/td[last()]" position="before">
            <td class="text-left">
                <span t-field="task.date_start" t-options="{'widget': 'date'}"/>
            </td>
            <td class="text-left">
                <span t-field="task.date_end" t-options="{'widget': 'date'}"/>
            </td>
        </xpath>
        <xpath expr="//tbody//tr/td[last()]" position="after">
            <td class="text-left">
                <span t-field="task.tag_ids" t-field-options='{"widget": "many2many_tags"}'/>
            </td>
        </xpath>
    </template>
    
    <template id="my_task" inherit_id="project.portal_my_task">
        <xpath expr="//span[@t-field='task.stage_id.name']" position="before">
            <t t-if="task.kanban_state=='in_progress'">
                <t t-set="label_color" t-value="'primary'"/>
                <t t-set="label_icon" t-value="'far fa-play-circle'"/>
            </t>
            <t t-elif="task.kanban_state=='blocked'">
                <t t-set="label_color" t-value="'danger'"/>
                <t t-set="label_icon" t-value="'fa fa-ban'"/>
            </t>
            <t t-elif="task.kanban_state=='normal'">
                <t t-set="label_color" t-value="'info'"/>
                <t t-set="label_icon" t-value="'far fa-circle'"/>
            </t>
            <t t-elif="task.kanban_state=='warning'">
                <t t-set="label_color" t-value="'warning'"/>
                <t t-set="label_icon" t-value="'fa fa-exclamation-circle'"/>
            </t>
            <t t-else="">
                <t t-set="label_color" t-value="'success'"/>
                <t t-set="label_icon" t-value="'far fa-check-circle'"/>
            </t>
            <span t-attf-class="badge badge-pill badge-#{label_color}">
                <i t-attf-class="#{label_icon}"/>
                <span t-esc="task.kanban_state_label"/>
            </span>
        </xpath>
        <xpath expr="//span[@t-field='task.stage_id.name']" position="attributes">
            <attribute name="t-att-style">'display: none;'</attribute>
        </xpath>
        <xpath expr="//t[@t-set='card_body']/div[2]" position="attributes">
            <attribute name="t-att-style">'display: none;'</attribute>
        </xpath>
        <xpath expr="//t[@t-set='card_body']/div[2]" position="after">
            <div class="row mb-4">
                <div class="col-12 col-md-6 mb-1" t-if="task.date_start">
                    <strong>Start Date:</strong> <span t-field="task.date_start" t-options='{"widget": "date"}'/>
                </div>
                <div class="col-12 col-md-6" t-if="task.date_end">
                    <strong>Finish Date:</strong> <span t-field="task.date_end" t-options='{"widget": "date"}'/>
                </div>
            </div>
        </xpath>
    </template>
</odoo>
